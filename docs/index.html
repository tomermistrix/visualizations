<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Video Compression Comparison</title>

    <!-- 1. Import the Beer Slider CSS -->
    <link rel="stylesheet" href="https://unpkg.com/beerslider/dist/BeerSlider.css">

    <!-- 2. Styling for the page, including new controls -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 960px;
            margin: 20px auto;
            padding: 0 15px;
            background-color: #f6f8fa;
        }
        h1, h2, h3 {
            border-bottom: 1px solid #eaecef;
            padding-bottom: .3em;
        }
        .comparison-container {
            margin-bottom: 60px;
            background-color: #fff;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        video {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        /* --- New Styles for Control Buttons --- */
        .controls-panel {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 4px;
        }
        .controls-panel div h3 {
            margin: 0 0 10px 0;
            font-size: 1em;
            text-align: center;
            border: none;
        }
        .video-select-btn {
            padding: 8px 12px;
            border: 1px solid #ccc;
            background-color: #fff;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9em;
            margin: 0 2px;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .video-select-btn:hover {
            background-color: #eef;
        }
        .video-select-btn.active {
            background-color: #0366d6;
            color: white;
            border-color: #0366d6;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Dynamic Video Compression Comparison</h1>
    <p>
        Use the buttons below each slider to dynamically select which videos to compare. 
        Sliders are generated automatically based on the available video sets.
    </p>

    <!-- This is the main container where JavaScript will inject our sliders -->
    <main id="comparisons-root"></main>

    <!-- Import BeerSlider annd our custom script at the end -->
    <script src="https://unpkg.com/beerslider/dist/BeerSlider.js"></script>
    <script>
    // ===================================================================
    //  STEP 1: CONFIGURE YOUR VIDEO DATA HERE
    // ===================================================================
    const videoData = [
        {
            index: 0,
            title: "Scene 1: Fountain",
            // Define the display names and file names for this set
            sources: {
                'Original':  'original.mp4',
                'Ours':      'ours.mp4',
                'H.264':     'h264.mp4',
                'H.265':     'h265.mp4'
            },
            // Set the default videos to show on load
            defaultLeft: 'Ours',
            defaultRight: 'H.264'
        },
        // {
        //     index: 1,
        //     title: "Scene 2: City Traffic",
        //     sources: {
        //         'Original':  'original.mp4',
        //         'Ours':      'ours.mp4',
        //         'H.264':     'h264.mp4',
        //         'H.265':     'h265.mp4'
        //     },
        //     defaultLeft: 'Ours',
        //     defaultRight: 'Original'
        // }
        // To add more video sets, just copy the object above and change the index and title.
        // For example:
        // ,{
        //     index: 2,
        //     title: "Scene 3: Nature",
        //     sources: { ... },
        //     defaultLeft: 'Ours',
        //     defaultRight: 'H.265'
        // }
    ];

    const VIDEO_BASE_PATH = 'assets/videos/';

    // ===================================================================
    //  STEP 2: DYNAMICALLY GENERATE HTML AND INITIALIZE
    // ===================================================================
    document.addEventListener('DOMContentLoaded', () => {
        const root = document.getElementById('comparisons-root');
        if (!root) return;

        // Loop through each video set in our configuration
        videoData.forEach(set => {
            const videoSetBasePath = `${VIDEO_BASE_PATH}${set.index}/`;

            // --- Create the HTML for the buttons ---
            let leftButtonsHTML = '';
            let rightButtonsHTML = '';
            Object.keys(set.sources).forEach(key => {
                const leftActiveClass = key === set.defaultLeft ? 'active' : '';
                const rightActiveClass = key === set.defaultRight ? 'active' : '';

                leftButtonsHTML += `<button class="video-select-btn ${leftActiveClass}" data-slider-index="${set.index}" data-side="left" data-source-key="${key}">${key}</button>`;
                rightButtonsHTML += `<button class="video-select-btn ${rightActiveClass}" data-slider-index="${set.index}" data-side="right" data-source-key="${key}">${key}</button>`;
            });

            // --- Create the complete HTML block for this comparison ---
            const comparisonBlock = document.createElement('div');
            comparisonBlock.className = 'comparison-container';
            comparisonBlock.innerHTML = `
                <h2>${set.title}</h2>
                <div id="slider-${set.index}" class="beer-slider" data-beer-label="${set.defaultLeft}">
                    <video id="video-left-${set.index}" loop muted autoplay playsinline>
                        <source src="${videoSetBasePath}${set.sources[set.defaultLeft]}" type="video/mp4">
                    </video>
                    <div class="beer-reveal" data-beer-label="${set.defaultRight}">
                        <video id="video-right-${set.index}" loop muted autoplay playsinline>
                            <source src="${videoSetBasePath}${set.sources[set.defaultRight]}" type="video/mp4">
                        </video>
                    </div>
                </div>
                <div class="controls-panel">
                    <div class="left-controls">
                        <h3>Left Video</h3>
                        ${leftButtonsHTML}
                    </div>
                    <div class="right-controls">
                        <h3>Right Video</h3>
                        ${rightButtonsHTML}
                    </div>
                </div>
            `;
            root.appendChild(comparisonBlock);

            // --- Initialize the slider and video sync for this new block ---
            new BeerSlider(document.getElementById(`slider-${set.index}`));
            syncVideos(`video-left-${set.index}`, `video-right-${set.index}`);
        });

        // Add a single, powerful event listener to the root container
        root.addEventListener('click', handleSourceChange);
    });

    // ===================================================================
    //  STEP 3: UTILITY FUNCTIONS (SYNC AND EVENT HANDLING)
    // ===================================================================

    // Reusable function to synchronize two video elements
    function syncVideos(masterId, slaveId) {
        const master = document.getElementById(masterId);
        const slave = document.getElementById(slaveId);
        if (!master || !slave) return;

        ['play', 'pause', 'seeking'].forEach(event => {
            master.addEventListener(event, () => {
                if(event === 'play' && slave.paused) slave.play();
                if(event === 'pause' && !slave.paused) slave.pause();
                if(event === 'seeking') slave.currentTime = master.currentTime;
            });
        });

        master.addEventListener('timeupdate', () => {
            if (Math.abs(master.currentTime - slave.currentTime) > 0.1) {
                slave.currentTime = master.currentTime;
            }
        });
    }

    // Handles clicks on any of the 'video-select-btn' buttons
    function handleSourceChange(event) {
        // Only act if a selection button was clicked
        if (!event.target.matches('.video-select-btn')) {
            return;
        }

        const button = event.target;
        const { sliderIndex, side, sourceKey } = button.dataset;

        // Find the video element to update
        const videoId = `video-${side}-${sliderIndex}`;
        const videoEl = document.getElementById(videoId);
        if (!videoEl) return;

        // Get the new source path from our config
        const setConfig = videoData.find(s => s.index == sliderIndex);
        const newSrc = `${VIDEO_BASE_PATH}${sliderIndex}/${setConfig.sources[sourceKey]}`;

        // Get the other video to sync with after loading
        const otherSide = side === 'left' ? 'right' : 'left';
        const otherVideoEl = document.getElementById(`video-${otherSide}-${sliderIndex}`);

        // Update the slider label
        const sliderEl = document.getElementById(`slider-${sliderIndex}`);
        if(side === 'left') {
            sliderEl.dataset.beerLabel = sourceKey;
            // The library needs a little nudge to update the visible label
            sliderEl.querySelector('.beer-handle').textContent = sourceKey;
        } else {
            sliderEl.querySelector('.beer-reveal').dataset.beerLabel = sourceKey;
        }
        
        // Change the source and reload the video
        videoEl.querySelector('source').setAttribute('src', newSrc);
        videoEl.load();
        videoEl.play(); // Start playing the new video
        otherVideoEl.play(); // Ensure the other video keeps playing too

        // Update active class on buttons
        button.parentElement.querySelectorAll('.video-select-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
    }

    </script>
</body>
</html>